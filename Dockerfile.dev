# ============================================
# Hexo åšå®¢å¼€å‘ç¯å¢ƒ Dockerfile
# ğŸ’¡ æ”¯æŒçƒ­é‡è½½å¼€å‘
# ä½œè€…: CJX
# é¡¹ç›®: SMLYFM.github.io
# ============================================

FROM node:18-alpine

LABEL maintainer="SMLYFM <yytcjx@gmail.com>"
LABEL description="SMLYFM Blog - Development Environment"

# ğŸ’¡ å®‰è£…æ„å»ºå·¥å…· (éƒ¨åˆ† npm åŒ…éœ€è¦)
RUN apk add --no-cache git python3 make g++

WORKDIR /app

# ğŸ’¡ å…ˆå¤åˆ¶ä¾èµ–æ–‡ä»¶ï¼Œåˆ©ç”¨ Docker ç¼“å­˜å±‚
COPY package*.json ./

# å®‰è£…æ‰€æœ‰ä¾èµ–ï¼ˆåŒ…æ‹¬ devDependenciesï¼‰
RUN npm install

# ğŸ’¡ å¤åˆ¶é…ç½®æ–‡ä»¶ï¼ˆæºç é€šè¿‡ volume æŒ‚è½½ï¼‰
COPY _config*.yml ./
COPY scaffolds ./scaffolds/

# æš´éœ² Hexo å¼€å‘æœåŠ¡å™¨ç«¯å£
EXPOSE 4000

# ğŸ’¡ å¥åº·æ£€æŸ¥
HEALTHCHECK --interval=30s --timeout=3s --start-period=10s --retries=3 \
    CMD wget --no-verbose --tries=1 --spider http://localhost:4000/ || exit 1

# ğŸ’¡ å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆåŒ…å«è‰ç¨¿é¢„è§ˆï¼‰
CMD ["npx", "hexo", "server", "--draft", "--watch"]
