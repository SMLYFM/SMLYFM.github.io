/**
 * ä¸“ä¸šæ•°å­¦å…¬å¼æ ·å¼ - Professional Math Styles
 * ðŸ’¡ å­¦æœ¯çº§ LaTeX å…¬å¼æ¸²æŸ“æ•ˆæžœ
 * ðŸ’¡ æ”¯æŒ MathJax 3.x / KaTeX
 */

/* ========================================
 * CSS å˜é‡ - å…¬å¼ä¸“ç”¨
 * ======================================== */

:root {
  /* ðŸ’¡ ä¸“ä¸šè“è‰²è°ƒè‰²æ¿ */
  --math-primary: #3b82f6;
  --math-primary-light: #60a5fa;
  --math-primary-dark: #2563eb;

  /* å…¬å¼æ–‡å­— */
  --math-text: #1e293b;

  /* ðŸ’¡ æ›´æ˜Žæ˜¾çš„èƒŒæ™¯å’Œè¾¹æ¡† */
  --math-bg-start: rgba(59, 130, 246, 0.06);
  --math-bg-end: rgba(99, 102, 241, 0.03);
  --math-border-color: #3b82f6;
  --math-hover-bg: rgba(59, 130, 246, 0.1);

  /* ðŸ’¡ é˜´å½± */
  --math-shadow: 0 2px 8px rgba(59, 130, 246, 0.12);
  --math-shadow-hover: 0 4px 16px rgba(59, 130, 246, 0.18);

  /* å…¬å¼ç¼–å· */
  --math-number-color: #64748b;
  --math-number-bg: rgba(100, 116, 139, 0.1);

  /* é—´è· */
  --math-block-margin: 1.5rem;
  --math-block-padding: 1.25rem 1.75rem;
  --math-inline-padding: 0.1em 0.25em;
}

[data-theme='dark'] {
  --math-primary: #60a5fa;
  --math-primary-light: #93c5fd;
  --math-primary-dark: #3b82f6;

  --math-text: #e2e8f0;

  --math-bg-start: rgba(96, 165, 250, 0.1);
  --math-bg-end: rgba(129, 140, 248, 0.05);
  --math-border-color: #60a5fa;
  --math-hover-bg: rgba(96, 165, 250, 0.15);

  --math-shadow: 0 2px 8px rgba(96, 165, 250, 0.15);
  --math-shadow-hover: 0 4px 16px rgba(96, 165, 250, 0.25);

  --math-number-color: #94a3b8;
  --math-number-bg: rgba(148, 163, 184, 0.15);
}

/* ========================================
 * è¡Œé—´å…¬å¼ (Display Math) - æ ¸å¿ƒæ ·å¼
 * ======================================== */

/* ðŸ’¡ åŒ…è£…å…¬å¼å—çš„å®¹å™¨ï¼ˆPandoc ç”Ÿæˆçš„ span.math.displayï¼‰ */
.math.display,
p:has(> mjx-container[display='true']),
.MathJax_Display {
  display: block;
  position: relative;
  margin: var(--math-block-margin) 0;
  padding: var(--math-block-padding);

  /* ðŸ’¡ æ¸å˜èƒŒæ™¯ - æ›´æ˜Žæ˜¾ */
  background: linear-gradient(
    135deg,
    var(--math-bg-start) 0%,
    var(--math-bg-end) 100%
  );

  /* ðŸ’¡ å·¦ä¾§ç²—è£…é¥°è¾¹æ¡† */
  border-left: 4px solid var(--math-border-color);
  border-radius: 0 12px 12px 0;

  /* ðŸ’¡ æŸ”å’Œé˜´å½± */
  box-shadow: var(--math-shadow);

  /* ðŸ’¡ è¿‡æ¸¡åŠ¨æ•ˆ */
  transition: all 0.25s ease;
}

/* ðŸ’¡ MathJax å®¹å™¨ç›´æŽ¥æ ·å¼ */
mjx-container[jax='CHTML'][display='true'] {
  display: block !important;
  margin: 0 !important;
  padding: 0;
  background: transparent !important;
  border: none !important;
  box-shadow: none !important;
}

/* ðŸ’¡ æ‚¬æµ®æ•ˆæžœ */
.math.display:hover,
p:has(> mjx-container[display='true']):hover,
.MathJax_Display:hover {
  background: linear-gradient(
    135deg,
    var(--math-hover-bg) 0%,
    rgba(99, 102, 241, 0.06) 100%
  );
  box-shadow: var(--math-shadow-hover);
  transform: translateX(3px);
  border-left-width: 5px;
}

/* ðŸ’¡ å…¬å¼å†…å®¹å±…ä¸­ */
.math.display mjx-container,
mjx-container[jax='CHTML'][display='true'] mjx-math {
  display: flex !important;
  justify-content: center;
}

/* ========================================
 * è¡Œå†…å…¬å¼ (Inline Math)
 * ======================================== */

/* ðŸ’¡ è¡Œå†…å…¬å¼å®¹å™¨ */
.math.inline,
mjx-container[jax='CHTML']:not([display='true']),
.MathJax:not(.MathJax_Display) {
  display: inline-block;
  padding: var(--math-inline-padding);
  margin: 0 0.1em;
  vertical-align: baseline;

  /* ðŸ’¡ è½»å¾®èƒŒæ™¯ */
  background: rgba(59, 130, 246, 0.05);
  border-radius: 4px;

  /* ðŸ’¡ è¿‡æ¸¡ */
  transition: background 0.2s ease;
}

mjx-container[jax='CHTML']:not([display='true']):hover,
.math.inline:hover {
  background: rgba(59, 130, 246, 0.1);
}

/* ðŸ’¡ æ·±è‰²æ¨¡å¼è¡Œå†…å…¬å¼ */
[data-theme='dark'] .math.inline,
[data-theme='dark'] mjx-container[jax='CHTML']:not([display='true']),
[data-theme='dark'] .MathJax:not(.MathJax_Display) {
  background: rgba(96, 165, 250, 0.08);
}

[data-theme='dark'] mjx-container[jax='CHTML']:not([display='true']):hover,
[data-theme='dark'] .math.inline:hover {
  background: rgba(96, 165, 250, 0.15);
}

/* ========================================
 * å…¬å¼ç¼–å·æ ·å¼
 * ======================================== */

mjx-container[jax='CHTML'][display='true'] mjx-mtd.mjx-eqn-num,
.MathJax_Display .mjx-eqn-num,
span.eqno,
.tag {
  position: absolute;
  right: 1rem;
  top: 50%;
  transform: translateY(-50%);

  /* ðŸ’¡ ç¼–å·æ ·å¼ */
  font-size: 0.85em;
  font-weight: 500;
  color: var(--math-number-color);
  padding: 0.25em 0.6em;
  background: var(--math-number-bg);
  border-radius: 6px;

  /* ðŸ’¡ å­—ä½“ */
  font-family: var(--font-mono, 'Consolas', monospace);
}

/* ========================================
 * ä¿®å¤ MathJax ç‰¹æ®Šå­—ç¬¦æ˜¾ç¤º
 * ======================================== */

/* ðŸ’¡ ä¿®å¤æ˜Ÿå·ç­‰ç‰¹æ®Šå­—ç¬¦çš„é¢œè‰² (ä¸è¦æ˜¾ç¤ºçº¢è‰²) */
mjx-mo,
mjx-mi,
mjx-mn,
.MathJax .mo,
.MathJax .mi,
.MathJax .mn {
  color: inherit !important;
}

/* ðŸ’¡ ç§»é™¤ MathJax é»˜è®¤çš„çº¢è‰²é”™è¯¯æ ·å¼ */
mjx-merror,
.MathJax_Error {
  color: var(--math-text) !important;
  background: transparent !important;
  border: none !important;
}

/* ========================================
 * å…¬å¼å…ƒç´ å¢žå¼º
 * ======================================== */

/* ðŸ’¡ åˆ†æ•°çº¿ */
mjx-frac mjx-line,
.mfrac .frac-line {
  border-top-width: 1.2px !important;
  border-color: var(--math-text) !important;
}

/* ðŸ’¡ ç§¯åˆ†/æ±‚å’Œç¬¦å·æ”¾å¤§ */
mjx-mo.mjx-n > mjx-c[c='âˆ«'],
mjx-mo.mjx-n > mjx-c[c='âˆ‘'],
mjx-mo.mjx-n > mjx-c[c='âˆ'] {
  font-size: 1.15em;
}

/* ðŸ’¡ æ‹¬å·é¢œè‰² - ä½¿ç”¨ä¸»é¢˜è“è‰² */
mjx-mrow > mjx-mo.mjx-stretch,
.mopen,
.mclose {
  color: var(--math-primary) !important;
  opacity: 0.9;
}

/* ========================================
 * å¤šè¡Œå…¬å¼çŽ¯å¢ƒ
 * ======================================== */

/* ðŸ’¡ align/gather çŽ¯å¢ƒ */
mjx-mtable.mjx-aling {
  margin: var(--math-block-margin) auto;
}

/* ðŸ’¡ cases çŽ¯å¢ƒ */
mjx-table.mjx-cases {
  margin-left: 0.5em;
}

/* ðŸ’¡ è¡Œé—´è·ä¼˜åŒ– */
mjx-mtable mjx-mtr {
  margin: 0.25em 0;
}

/* ========================================
 * é‡è¦å…¬å¼é«˜äº®
 * ======================================== */

.math-important .math.display,
.math-important p:has(> mjx-container[display='true']) {
  border-left-color: #f59e0b;
  background: linear-gradient(
    135deg,
    rgba(245, 158, 11, 0.08) 0%,
    rgba(245, 158, 11, 0.03) 100%
  );
}

.math-important .math.display:hover,
.math-important p:has(> mjx-container[display='true']):hover {
  background: linear-gradient(
    135deg,
    rgba(245, 158, 11, 0.12) 0%,
    rgba(245, 158, 11, 0.06) 100%
  );
  box-shadow: 0 4px 16px rgba(245, 158, 11, 0.2);
}

/* ========================================
 * å…¬å¼æº¢å‡ºå¤„ç†
 * ======================================== */

.post-content .math.display,
.post-content p:has(> mjx-container[display='true']) {
  overflow-x: auto;
  overflow-y: hidden;

  /* ðŸ’¡ éšè—æ»šåŠ¨æ¡ä½†ä¿ç•™åŠŸèƒ½ */
  scrollbar-width: thin;
  scrollbar-color: var(--math-border-color) transparent;
}

.post-content .math.display::-webkit-scrollbar,
.post-content p:has(> mjx-container[display='true'])::-webkit-scrollbar {
  height: 6px;
}

.post-content .math.display::-webkit-scrollbar-thumb,
.post-content p:has(> mjx-container[display='true'])::-webkit-scrollbar-thumb {
  background: var(--math-border-color);
  border-radius: 3px;
  opacity: 0.5;
}

/* ========================================
 * å“åº”å¼è®¾è®¡
 * ======================================== */

@media screen and (max-width: 768px) {
  .math.display,
  p:has(> mjx-container[display='true']),
  .MathJax_Display {
    margin: 1rem 0;
    padding: 1rem 1.25rem;
    border-radius: 0 8px 8px 0;
    font-size: 0.92em;
  }

  /* ðŸ’¡ ç§»åŠ¨ç«¯å…¬å¼ç¼–å· */
  mjx-container[jax='CHTML'][display='true'] mjx-mtd.mjx-eqn-num,
  span.eqno,
  .tag {
    position: relative;
    right: auto;
    top: auto;
    transform: none;
    display: block;
    text-align: right;
    margin-top: 0.5rem;
  }
}

/* ========================================
 * æ‰“å°æ ·å¼
 * ======================================== */

@media print {
  .math.display,
  p:has(> mjx-container[display='true']),
  .MathJax_Display {
    background: none !important;
    border-left: 2px solid #000 !important;
    box-shadow: none !important;
    page-break-inside: avoid;
  }

  .math.inline,
  mjx-container[jax='CHTML']:not([display='true']) {
    background: none !important;
  }
}

/* ========================================
 * åŠ¨ç”»æ•ˆæžœ
 * ======================================== */

@keyframes mathSlideIn {
  from {
    opacity: 0;
    transform: translateX(-10px);
  }

  to {
    opacity: 1;
    transform: translateX(0);
  }
}

.math.display,
p:has(> mjx-container[display='true']) {
  animation: mathSlideIn 0.4s ease-out;
}
