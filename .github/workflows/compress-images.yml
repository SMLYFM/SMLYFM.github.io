# ==================================================
# å›¾ç‰‡è‡ªåŠ¨å‹ç¼©å·¥ä½œæµ
# åœ¨ PR æ—¶è‡ªåŠ¨å‹ç¼© source/ ç›®å½•ä¸‹çš„å›¾ç‰‡
# ==================================================

name: Compress Images

on:
  pull_request:
    paths:
      - 'source/**/*.png'
      - 'source/**/*.jpg'
      - 'source/**/*.jpeg'
      - 'source/**/*.gif'
      - 'source/**/*.webp'

permissions:
  contents: write
  pull-requests: write

jobs:
  compress:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ github.head_ref }}
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Compress Images
        uses: calibreapp/image-actions@main
        with:
          githubToken: ${{ secrets.GITHUB_TOKEN }}
          # ğŸ’¡ å‹ç¼©é…ç½®
          jpegQuality: '85'
          jpegProgressive: true
          pngQuality: '85'
          webpQuality: '85'
          ignorePaths: 'node_modules/**,public/**,.deploy_git/**'

      - name: Commit compressed images
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: 'ci: ğŸ–¼ï¸ auto-compress images'
          file_pattern: 'source/**/*.{png,jpg,jpeg,gif,webp}'
