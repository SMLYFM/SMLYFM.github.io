# Makefile ä½¿ç”¨æŒ‡å—

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»åšå®¢é¡¹ç›®ä¸­Makefileçš„ä½¿ç”¨æ–¹æ³•ã€‚

## ğŸ“‹ ç›®å½•

- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [å¸¸ç”¨å‘½ä»¤](#å¸¸ç”¨å‘½ä»¤)
- [å†…å®¹ç®¡ç†](#å†…å®¹ç®¡ç†)
- [æ„å»ºéƒ¨ç½²](#æ„å»ºéƒ¨ç½²)
- [ç»´æŠ¤å·¥å…·](#ç»´æŠ¤å·¥å…·)
- [é«˜çº§åŠŸèƒ½](#é«˜çº§åŠŸèƒ½)

---

## å¿«é€Ÿå¼€å§‹

### æŸ¥çœ‹æ‰€æœ‰å‘½ä»¤

```bash
make help
# æˆ–ç®€å•ä½¿ç”¨
make
```

è¿™å°†æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨å‘½ä»¤å’Œè¯´æ˜ã€‚

### ç¯å¢ƒæ£€æŸ¥

```bash
make check
```

æ£€æŸ¥é¡¹ç›®çŠ¶æ€,åŒ…æ‹¬:

- Node.js å’Œ npm ç‰ˆæœ¬
- Hexo ç‰ˆæœ¬
- Git çŠ¶æ€
- æ–‡ç« ç»Ÿè®¡

---

## å¸¸ç”¨å‘½ä»¤

### é¡¹ç›®ç®¡ç†

| å‘½ä»¤ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `make install` | å®‰è£…é¡¹ç›®ä¾èµ– | `make install` |
| `make upgrade` | å‡çº§ä¾èµ–åŒ… | `make upgrade` |
| `make check` | æ£€æŸ¥é¡¹ç›®çŠ¶æ€ | `make check` |
| `make status` | æŸ¥çœ‹GitçŠ¶æ€ | `make status` |

---

## å†…å®¹ç®¡ç†

### åˆ›å»ºæ–°æ–‡ç« 

#### æ–¹å¼1: äº¤äº’å¼åˆ›å»º(æ¨è)

```bash
make new
```

è¿è¡Œäº¤äº’å¼è„šæœ¬,å¼•å¯¼ä½ è¾“å…¥æ ‡é¢˜ã€åˆ†ç±»ã€æ ‡ç­¾ç­‰ã€‚

#### æ–¹å¼2: æŒ‡å®šæ ‡é¢˜åˆ›å»º

```bash
make new TITLE="æˆ‘çš„ç¬¬ä¸€ç¯‡æ–‡ç« "
```

ä½¿ç”¨HexoåŸç”Ÿå‘½ä»¤å¿«é€Ÿåˆ›å»ºã€‚

#### æ–¹å¼3: ä½¿ç”¨æ¨¡æ¿åˆ›å»º(æœ€å¼ºå¤§)

```bash
make template-post TITLE="Rustå­¦ä¹ ç¬”è®°" CAT="tech" TAGS="rust programming"
```

åˆ›å»ºå¸¦æœ‰å®Œæ•´æ¨¡æ¿çš„æ–‡ç« ,åŒ…æ‹¬:

- è‡ªåŠ¨å¡«å……æ—¶é—´æˆ³
- é¢„å®šä¹‰åˆ†ç±»å’Œæ ‡ç­¾
- ç»“æ„åŒ–çš„å†…å®¹æ¨¡æ¿

**å‚æ•°è¯´æ˜**:

- `TITLE`: æ–‡ç« æ ‡é¢˜(å¿…éœ€)
- `CAT`: åˆ†ç±»(å¯é€‰,é»˜è®¤: blog)
- `TAGS`: æ ‡ç­¾,ç©ºæ ¼åˆ†éš”(å¯é€‰)

**ç¤ºä¾‹**:

```bash
# æŠ€æœ¯æ–‡ç« 
make template-post TITLE="Dockerå®¹å™¨åŒ–å®è·µ" CAT="tech" TAGS="docker devops"

# æ•°å­¦æ–‡ç« 
make template-post TITLE="åå¾®åˆ†æ–¹ç¨‹å…¥é—¨" CAT="math" TAGS="pde analysis"

# ç”Ÿæ´»æ–‡ç« 
make template-post TITLE="2026å¹´æ€»ç»“" CAT="life" TAGS="summary"
```

---

### åˆ›å»ºè‰ç¨¿

```bash
make draft TITLE="è‰ç¨¿æ ‡é¢˜"
```

è‰ç¨¿ä¿å­˜åœ¨`source/_drafts/`,ä¸ä¼šå‘å¸ƒåˆ°ç½‘ç«™ã€‚

---

### å‘å¸ƒè‰ç¨¿

```bash
make publish DRAFT="è‰ç¨¿å"
```

å°†è‰ç¨¿ç§»åŠ¨åˆ°`source/_posts/`,æˆä¸ºæ­£å¼æ–‡ç« ã€‚

---

### åˆ—å‡ºæ‰€æœ‰æ–‡ç« 

```bash
make list
```

æ˜¾ç¤ºæ‰€æœ‰æ­£å¼æ–‡ç« å’Œè‰ç¨¿ã€‚

---

### ä½¿ç”¨Markdownæ¨¡æ¿ç”Ÿæˆå™¨

```bash
bash tools/create-markdown.sh
```

æä¾›4ç§ä¸“ä¸šæ¨¡æ¿:

1. **åŸºç¡€æ–‡ç« ** - é€‚åˆä¸€èˆ¬å†…å®¹
2. **æŠ€æœ¯æ–‡ç« ** - åŒ…å«ä»£ç å—ã€æŠ€æœ¯é€‰å‹ã€æ€§èƒ½å¯¹æ¯”ç­‰
3. **æ•°å­¦/å­¦æœ¯æ–‡ç« ** - æ”¯æŒLaTeXå…¬å¼ã€å®šç†è¯æ˜
4. **æ•™ç¨‹æ–‡ç« ** - åŒ…å«æ­¥éª¤ã€å¸¸è§é—®é¢˜ã€æœ€ä½³å®è·µ

**ç‰¹æ€§**:

- âœ… è‡ªåŠ¨å¡«å……å½“å‰æ—¶é—´
- âœ… æ™ºèƒ½åˆ†ç±»å’Œæ ‡ç­¾
- âœ… é¢„å®šä¹‰å†…å®¹ç»“æ„
- âœ… æ”¯æŒè‰ç¨¿å’Œæ­£å¼æ–‡ç« 
- âœ… å¯é€‰æ‹©æ˜¯å¦ç«‹å³æ‰“å¼€ç¼–è¾‘å™¨

---

## æ„å»ºéƒ¨ç½²

### æœ¬åœ°å¼€å‘

```bash
# å¯åŠ¨æœ¬åœ°æœåŠ¡å™¨(ä¸å«è‰ç¨¿)
make server
# æˆ–ä½¿ç”¨åˆ«å
make s

# å¼€å‘æ¨¡å¼(åŒ…å«è‰ç¨¿)
make dev
# æˆ–ä½¿ç”¨åˆ«å
make d
```

è®¿é—® `http://localhost:4000` é¢„è§ˆåšå®¢ã€‚

---

### æ¸…ç†ç¼“å­˜

```bash
make clean
# æˆ–ä½¿ç”¨åˆ«å
make c
```

æ¸…ç†Hexoç¼“å­˜å’Œç”Ÿæˆçš„æ–‡ä»¶ã€‚

---

### æ„å»ºç½‘ç«™

```bash
make build
# æˆ–ä½¿ç”¨åˆ«å
make b
```

ç”Ÿæˆé™æ€æ–‡ä»¶åˆ°`public/`ç›®å½•ã€‚

---

### éƒ¨ç½²åˆ°GitHub Pages

```bash
make deploy
# æˆ–ä½¿ç”¨åˆ«å
make dp
```

å°†é™æ€æ–‡ä»¶éƒ¨ç½²åˆ°`main`åˆ†æ”¯ã€‚

---

### ä¸€é”®åŒæ­¥(æ¨è)

```bash
make sync
```

**è¿™æ˜¯æœ€å¸¸ç”¨çš„å‘½ä»¤!**

è‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æ­¥éª¤:

1. æäº¤æºç åˆ°`master`åˆ†æ”¯
2. æ¨é€åˆ°è¿œç¨‹ä»“åº“
3. æ¸…ç†ç¼“å­˜
4. æ„å»ºé™æ€æ–‡ä»¶
5. éƒ¨ç½²åˆ°`main`åˆ†æ”¯

**å®Œæ•´çš„å†™ä½œâ†’å‘å¸ƒæµç¨‹**:

```bash
# 1. åˆ›å»ºæ–‡ç« 
make new TITLE="æ–°æ–‡ç« "

# 2. ç¼–å†™å†…å®¹...

# 3. ä¸€é”®åŒæ­¥
make sync
```

---

## ç»´æŠ¤å·¥å…·

### Gitæ“ä½œ

#### æäº¤å¹¶æ¨é€æºç 

```bash
make push
# æˆ–ä½¿ç”¨åˆ«å
make p
```

äº¤äº’å¼æäº¤å¹¶æ¨é€åˆ°`master`åˆ†æ”¯ã€‚

#### æ‹‰å–è¿œç¨‹æ›´æ–°

```bash
make pull
```

ä»è¿œç¨‹ä»“åº“æ‹‰å–æœ€æ–°æ›´æ”¹ã€‚

---

### å¤‡ä»½ä¸æ¢å¤

#### å¤‡ä»½åšå®¢å†…å®¹

```bash
make backup
```

å°†`source/`ã€é…ç½®æ–‡ä»¶ç­‰æ‰“åŒ…å¤‡ä»½åˆ°`../backup/`ç›®å½•ã€‚

**å¤‡ä»½å†…å®¹**:

- source/ (æ‰€æœ‰æ–‡ç« å’Œèµ„æº)
- _config.yml
- _config.butterfly.yml
- package.json

**ä¸å¤‡ä»½**:

- node_modules/
- public/
- .deploy_git/
- .git/

#### æ¢å¤å¤‡ä»½

```bash
make restore
```

æ¢å¤æœ€æ–°çš„å¤‡ä»½æ–‡ä»¶ã€‚

---

## é«˜çº§åŠŸèƒ½

### æ–‡ç« ç»Ÿè®¡

#### å­—æ•°ç»Ÿè®¡

```bash
make count
```

ç»Ÿè®¡æ¯ç¯‡æ–‡ç« çš„å­—æ•°å’Œæ€»å­—æ•°ã€‚

**ç¤ºä¾‹è¾“å‡º**:

```
hello-world.md                                        150 å­—
Rust-å­¦ä¹ .md                                          2340 å­—
my-first-rust-article.md                              890 å­—

æ€»è®¡: 5 ç¯‡æ–‡ç« , 8920 å­—
```

---

### æœç´¢æ–‡ç« 

```bash
make grep-posts KEYWORD="å…³é”®è¯"
```

åœ¨æ‰€æœ‰æ–‡ç« ä¸­æœç´¢å…³é”®è¯ã€‚

**ç¤ºä¾‹**:

```bash
make grep-posts KEYWORD="Docker"
make grep-posts KEYWORD="å‡½æ•°"
```

---

### ç›‘å¬æ–‡ä»¶å˜åŒ–

```bash
make watch
```

ç›‘å¬`source/`ç›®å½•çš„å˜åŒ–,è‡ªåŠ¨é‡æ–°æ„å»ºã€‚

**æ³¨æ„**: éœ€è¦å®‰è£…`inotify-tools`:

```bash
sudo dnf install inotify-tools
```

---

### CI/CDå‘½ä»¤

#### CIæµ‹è¯•

```bash
make ci-test
```

æ¨¡æ‹ŸCIç¯å¢ƒè¿›è¡Œæµ‹è¯•:

- ä½¿ç”¨`npm ci`å®‰è£…ä¾èµ–(æ›´å¿«)
- æ¸…ç†ç¼“å­˜
- æ„å»ºé™æ€æ–‡ä»¶

#### CIéƒ¨ç½²

```bash
make ci-deploy
```

CIç¯å¢ƒå®Œæ•´éƒ¨ç½²æµç¨‹ã€‚

---

### ç‰ˆæœ¬ä¿¡æ¯

```bash
make version
```

æ˜¾ç¤ºè¯¦ç»†çš„ç‰ˆæœ¬ä¿¡æ¯:

- Node.js, npm, Hexoç‰ˆæœ¬
- Gitåˆ†æ”¯å’Œæäº¤ä¿¡æ¯
- é¡¹ç›®è·¯å¾„

---

### ä¾èµ–ç®¡ç†

#### æŸ¥çœ‹ä¾èµ–æ ‘

```bash
make deps-tree
```

æ˜¾ç¤ºé¡¶å±‚ä¾èµ–åŒ…ã€‚

#### å®‰å…¨å®¡è®¡

```bash
make audit
```

æ£€æŸ¥ä¾èµ–çš„å®‰å…¨æ¼æ´ã€‚

---

## åˆ«åå‘½ä»¤

ä¸ºäº†æé«˜æ•ˆç‡,Makefileæä¾›äº†ç®€çŸ­çš„åˆ«å:

| åˆ«å | åŸå‘½ä»¤ | è¯´æ˜ |
|------|--------|------|
| `make s` | `make server` | å¯åŠ¨æœåŠ¡å™¨ |
| `make d` | `make dev` | å¼€å‘æ¨¡å¼ |
| `make b` | `make build` | æ„å»º |
| `make dp` | `make deploy` | éƒ¨ç½² |
| `make n` | `make new` | æ–°æ–‡ç«  |
| `make p` | `make push` | æ¨é€ |
| `make l` | `make list` | åˆ—è¡¨ |
| `make c` | `make clean` | æ¸…ç† |

---

## å·¥ä½œæµç¤ºä¾‹

### æ—¥å¸¸å†™ä½œæµç¨‹

```bash
# 1. æ£€æŸ¥é¡¹ç›®çŠ¶æ€
make check

# 2. åˆ›å»ºæ–°æ–‡ç« (ä½¿ç”¨æ¨¡æ¿)
make template-post TITLE="æ·±å…¥ç†è§£Rustæ‰€æœ‰æƒ" CAT="tech" TAGS="rust programming"

# 3. ç¼–è¾‘æ–‡ç« 
nvim source/_posts/æ·±å…¥ç†è§£Rustæ‰€æœ‰æƒ.md

# 4. æœ¬åœ°é¢„è§ˆ
make dev

# 5. æ»¡æ„å,ä¸€é”®åŒæ­¥
make sync
```

---

### åä½œå¼€å‘æµç¨‹

```bash
# 1. æ‹‰å–æœ€æ–°æ›´æ–°
make pull

# 2. æŸ¥çœ‹çŠ¶æ€
make status

# 3. è¿›è¡Œä¿®æ”¹...

# 4. æäº¤å¹¶æ¨é€
make push

# 5. éƒ¨ç½²
make deploy
```

---

### å®šæœŸç»´æŠ¤æµç¨‹

```bash
# 1. å¤‡ä»½å†…å®¹
make backup

# 2. å‡çº§ä¾èµ–
make upgrade

# 3. å®‰å…¨å®¡è®¡
make audit

# 4. ç»Ÿè®¡æ–‡ç« 
make count
make list
```

---

## è„šæœ¬è¯´æ˜

### tools/deploy.sh

å¢å¼ºçš„éƒ¨ç½²è„šæœ¬,æä¾›:

- âœ… å®Œæ•´çš„ç¯å¢ƒæ£€æŸ¥
- âœ… GitçŠ¶æ€æ‘˜è¦
- âœ… äº¤äº’å¼æäº¤
- âœ… æ„å»ºå’Œéƒ¨ç½²
- âœ… é”™è¯¯å¤„ç†å’Œæç¤º

**ä½¿ç”¨**:

```bash
# äº¤äº’æ¨¡å¼
bash tools/deploy.sh

# è‡ªåŠ¨æ¨¡å¼
bash tools/deploy.sh manual
```

---

### tools/create-markdown.sh

ä¸“ä¸šçš„Markdownæ¨¡æ¿ç”Ÿæˆå™¨ã€‚

**ä½¿ç”¨**:

```bash
bash tools/create-markdown.sh
```

**ç”Ÿæˆçš„æ¨¡æ¿åŒ…å«**:

- Front Matter(æ ‡é¢˜ã€æ—¥æœŸã€åˆ†ç±»ã€æ ‡ç­¾)
- ç»“æ„åŒ–å†…å®¹æ¡†æ¶
- ç›¸å…³å…ƒæ•°æ®
- ä»£ç å—ç¤ºä¾‹(æŠ€æœ¯æ–‡ç« )
- æ•°å­¦å…¬å¼æ¡†æ¶(å­¦æœ¯æ–‡ç« )
- æ­¥éª¤æŒ‡å—(æ•™ç¨‹)

---

## å¸¸è§é—®é¢˜

### Q: makeå‘½ä»¤æ‰¾ä¸åˆ°?

**A**: ç¡®ä¿å·²å®‰è£…`make`:

```bash
sudo dnf install make
```

### Q: å¦‚ä½•è‡ªå®šä¹‰Makefile?

**A**: ç¼–è¾‘é¡¹ç›®æ ¹ç›®å½•çš„`Makefile`æ–‡ä»¶:

```bash
nvim Makefile
```

### Q: æ¨¡æ¿æ–‡ç« çš„æ ¼å¼å¦‚ä½•ä¿®æ”¹?

**A**: ç¼–è¾‘`tools/create-markdown.sh`,ä¿®æ”¹ç›¸åº”çš„æ¨¡æ¿å‡½æ•°ã€‚

### Q: å¦‚ä½•æ·»åŠ æ–°çš„åˆ†ç±»å’Œæ ‡ç­¾?

**A**:

1. ç¼–è¾‘`_config.yml`ä¸­çš„`category_map`å’Œ`tag_map`
2. ç¼–è¾‘`tools/create-markdown.sh`ä¸­çš„åˆ†ç±»é€‰é¡¹

---

## æœ€ä½³å®è·µ

### 1. ä½¿ç”¨æ¨¡æ¿åˆ›å»ºæ–‡ç« 

ä¼˜å…ˆä½¿ç”¨`make template-post`æˆ–`tools/create-markdown.sh`,å®ƒä»¬æä¾›:

- ä¸€è‡´çš„ç»“æ„
- å®Œæ•´çš„å…ƒæ•°æ®
- ä¸“ä¸šçš„æ ¼å¼

### 2. å®šæœŸå¤‡ä»½

```bash
# æ¯å‘¨å¤‡ä»½
make backup
```

### 3. ä½¿ç”¨syncå‘½ä»¤

```bash
# æ›¿ä»£å¤šä¸ªå‘½ä»¤
make sync
```

ä¸€æ­¥å®Œæˆæ‰€æœ‰æ“ä½œã€‚

### 4. åˆ©ç”¨åˆ«å

```bash
make d   # æ¯” make dev æ›´å¿«
make s   # æ¯” make server æ›´å¿«
```

### 5. ç›‘å¬æ¨¡å¼å¼€å‘

```bash
make watch
```

ä¿®æ”¹æ–‡ä»¶è‡ªåŠ¨é‡æ–°æ„å»ºã€‚

---

## æŠ€æœ¯ç»†èŠ‚

### Makefileç‰¹æ€§

- ä½¿ç”¨`.PHONY`å£°æ˜ä¼ªç›®æ ‡
- å½©è‰²è¾“å‡ºæå‡å¯è¯»æ€§
- è‡ªåŠ¨ç”Ÿæˆå¸®åŠ©æ–‡æ¡£
- å˜é‡åŒ–é…ç½®
- é”™è¯¯å¤„ç†

### æ—¶é—´æˆ³å˜é‡

Makefileä¸­å®šä¹‰çš„æ—¶é—´å˜é‡:

- `TIMESTAMP`: å®Œæ•´æ—¶é—´æˆ³ (YYYY-MM-DD HH:MM:SS)
- `DATE`: æ—¥æœŸ (YYYY-MM-DD)
- `TIME`: æ—¶é—´ (HH:MM:SS)

### ç›®å½•å˜é‡

- `POST_DIR`: æ–‡ç« ç›®å½•
- `DRAFT_DIR`: è‰ç¨¿ç›®å½•
- `PUBLIC_DIR`: æ„å»ºè¾“å‡ºç›®å½•
- `DEPLOY_DIR`: éƒ¨ç½²ä¸´æ—¶ç›®å½•

---

## å‚è€ƒèµ„æ–™

- [GNU Makeæ–‡æ¡£](https://www.gnu.org/software/make/manual/)
- [Hexoæ–‡æ¡£](https://hexo.io/zh-cn/docs/)
- [Bashè„šæœ¬æ•™ç¨‹](https://www.gnu.org/software/bash/manual/)

---

## æ€»ç»“

Makefileæä¾›äº†å®Œæ•´çš„åšå®¢ç®¡ç†è§£å†³æ–¹æ¡ˆ:

âœ… **ä¸€ä½“åŒ–ç®¡ç†**: ä»åˆ›å»ºåˆ°éƒ¨ç½²çš„å…¨æµç¨‹  
âœ… **é«˜æ•ˆå·¥ä½œæµ**: å•å‘½ä»¤å®Œæˆå¤æ‚æ“ä½œ  
âœ… **ä¸“ä¸šæ¨¡æ¿**: å¤šç§æ–‡ç« ç±»å‹æ¨¡æ¿  
âœ… **è‡ªåŠ¨åŒ–**: Gitã€æ„å»ºã€éƒ¨ç½²è‡ªåŠ¨åŒ–  
âœ… **æ˜“ç”¨æ€§**: æ¸…æ™°çš„å¸®åŠ©æ–‡æ¡£å’Œåˆ«å

**ç«‹å³å¼€å§‹ä½¿ç”¨**:

```bash
make help   # æŸ¥çœ‹æ‰€æœ‰å‘½ä»¤
make check  # æ£€æŸ¥é¡¹ç›®çŠ¶æ€
make sync   # ä¸€é”®åŒæ­¥å‘å¸ƒ
```

---

**æ›´æ–°æ—¥æœŸ**: 2026-01-23  
**ä½œè€…**: CJX  
**é¡¹ç›®**: SMLYFM.github.io
