# ============================================
# Docker Compose å¼€å‘ç¯å¢ƒé…ç½®
# ğŸ’¡ æ”¯æŒçƒ­é‡è½½å¼€å‘
# ä½œè€…: CJX
# é¡¹ç›®: SMLYFM.github.io
#
# ä½¿ç”¨æ–¹æ³•:
#   docker compose -f docker-compose.dev.yml up
#   docker compose -f docker-compose.dev.yml down
# ============================================

version: '3.8'

services:
  blog-dev:
    build:
      context: .
      dockerfile: Dockerfile.dev
    container_name: smlyfm-blog-dev
    restart: unless-stopped
    ports:
      - '${DEV_PORT:-4000}:4000'
    volumes:
      # ğŸ’¡ æŒ‚è½½æºç ç›®å½•ï¼Œå®ç°çƒ­é‡è½½
      - ./source:/app/source
      - ./themes:/app/themes:ro
      - ./_config.yml:/app/_config.yml:ro
      - ./_config.butterfly.yml:/app/_config.butterfly.yml:ro
      # ğŸ’¡ æŒä¹…åŒ– node_modules é¿å…æ¯æ¬¡é‡å»º
      - blog_node_modules:/app/node_modules
    environment:
      - TZ=Asia/Shanghai
      - NODE_ENV=development
    healthcheck:
      test: [ 'CMD', 'wget', '--no-verbose', '--tries=1', '--spider', 'http://localhost:4000/' ]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 30s
    networks:
      - devnet

volumes:
  blog_node_modules:


networks:
  devnet:
    driver: bridge
